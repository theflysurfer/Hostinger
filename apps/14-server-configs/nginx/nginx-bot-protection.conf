# Nginx Bot Protection Snippet
# Pour bloquer les scans automatiques qui empêchent docker-autostart de fonctionner
# À inclure dans /etc/nginx/snippets/bot-protection.conf

# Bloquer fichiers cachés et dossiers sensibles
location ~ /\. {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# Bloquer scans .env (Laravel, Node.js, etc.)
location ~ \.env {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# Bloquer scans WordPress même sur sites non-WordPress
location ~ (xmlrpc\.php|wp-admin|wp-login\.php|wp-config\.php|wp-content/debug\.log) {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# Bloquer fichiers de configuration exposés
location ~ (composer\.json|composer\.lock|package\.json|yarn\.lock|\.htaccess|\.htpasswd|web\.config) {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# Bloquer scans d'admin panels
location ~ /(admin|administrator|phpmyadmin|pma|adminer|mysql|db|database) {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# Bloquer scanners connus par User-Agent
if ($http_user_agent ~* (l9scan|leakix|masscan|shodan|censys|zgrab|sqlmap|nikto|nmap|acunetix)) {
    return 403;
}

# Bloquer requêtes avec chemins suspects
location ~ (phpinfo|info\.php|test\.php|shell\.php|config\.json|config\.php|_all_dbs|telescope) {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}
